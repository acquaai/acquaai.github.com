<!DOCTYPE html>
<html lang="en">
  <head><meta name="generator" content="Hexo 3.9.0">
    
<!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">


<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">

<meta name="theme-color" content="#f8f5ec">
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">















  <link rel="alternate" href="https://acquaai.github.io/atom.xml" title="Acqua">




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=2.6.0">



<link rel="canonical" href="https://acquaai.github.io/page/9/">


<link rel="stylesheet" type="text/css" href="/css/style.css?v=2.6.0">






  



  <script id="baidu_push">
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>









    <title> Acqua </title><!-- hexo-inject:begin --><!-- hexo-inject:end -->
  </head>

  <body><div id="mobile-navbar" class="mobile-navbar">
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div class="mobile-header-logo">
    <a href="/." class="logo">Acqua</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>

<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    
      <a href="/">
        <li class="mobile-menu-item">
          
          
            Home
          
        </li>
      </a>
    
      <a href="/archives/">
        <li class="mobile-menu-item">
          
          
            Archives
          
        </li>
      </a>
    
      <a href="/about">
        <li class="mobile-menu-item">
          
          
            About
          
        </li>
      </a>
    
  </ul>
</nav>

    <div class="container" id="mobile-panel">
      <header id="header" class="header"><div class="logo-wrapper">
  <a href="/." class="logo">Acqua</a>
</div>

<nav class="site-navbar">
  
    <ul id="menu" class="menu">
      
        <li class="menu-item">
          <a class="menu-item-link" href="/">
            
            
              Home
            
          </a>
        </li>
      
        <li class="menu-item">
          <a class="menu-item-link" href="/archives/">
            
            
              Archives
            
          </a>
        </li>
      
        <li class="menu-item">
          <a class="menu-item-link" href="/about">
            
            
              About
            
          </a>
        </li>
      
    </ul>
  
</nav>

      </header>

      <main id="main" class="main">
        <div class="content-wrapper">
          <div id="content" class="content">
            
  <section id="posts" class="posts">
    
      
  <article class="post">
    <header class="post-header">
      <h1 class="post-title">
        
          <a class="post-link" href="/2017/12/16/mgr-single-m/">MGR单主复制配置流程</a>
        
      </h1>

      <div class="post-meta">
        <span class="post-time">
          2017-12-16
        </span>
        
          <div class="post-category">
            
              <a href="/categories/MySQL/">MySQL</a>
            
          </div>
        
        
      </div>
    </header>

    
    

    <div class="post-content">
      
        
        
          
        

        
          <h2 id="mysql的参数设置"><a class="markdownIt-Anchor" href="#mysql的参数设置"></a> MySQL的参数设置</h2>
<p><code>修改MySQL参数文件---/etc/my.cnf</code></p>
<h3 id="开启binlog和relaylog功能"><a class="markdownIt-Anchor" href="#开启binlog和relaylog功能"></a> 开启Binlog和Relaylog功能</h3>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">server_id = 1</span><br><span class="line">log_bin = binlog</span><br><span class="line">log_slave_updates = ON</span><br><span class="line">relay_log = relay-log</span><br></pre></td></tr></table></figure>
<h3 id="开启gtid功能"><a class="markdownIt-Anchor" href="#开启gtid功能"></a> 开启GTID功能</h3>
<p>Group Replication必须使用GTID功能。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gtid_mode = ON</span><br><span class="line">enforce_gtid_consistency = ON</span><br></pre></td></tr></table></figure>
          <div class="read-more">
            <a href="/2017/12/16/mgr-single-m/" class="read-more-link">Read more..</a>
          </div>
        
      
    </div>

    

    

  </article>

    
      
  <article class="post">
    <header class="post-header">
      <h1 class="post-title">
        
          <a class="post-link" href="/2017/12/15/mysql-log-maintenance/">MySQL log maintenance</a>
        
      </h1>

      <div class="post-meta">
        <span class="post-time">
          2017-12-15
        </span>
        
          <div class="post-category">
            
              <a href="/categories/MySQL/">MySQL</a>
            
          </div>
        
        
      </div>
    </header>

    
    

    <div class="post-content">
      
        
        
          
        

        
          <p>我们可以手动将日志文件中的数据刷到磁盘上，这一动作将触发MySQL服务器使用一个新的日志文件。过程如下：</p>
<ul>
<li>
<p>If general query logging or slow query logging to a log file is enabled, the server <code>closes and reopens</code> the general query log file or slow query log file.</p>
</li>
<li>
<p>If binary logging is enabled, the server closes the current binary log file and opens a new log file with the next sequence number.</p>
</li>
<li>
<p>If the server was started with the --log-error option to cause the error log to be written to a file, the server closes and reopens the log file.</p>
</li>
</ul>
<p>The server creates a new binary log file when you flush the logs. However, it just closes and reopens the general and slow query log files. To cause new files to be created on Unix, rename the current log files before flushing them. At flush time, the server opens new log files with the original names. For example, if the general and slow query log files are named mysql.log and mysql-slow.log, you can use a series of commands like this:</p>
          <div class="read-more">
            <a href="/2017/12/15/mysql-log-maintenance/" class="read-more-link">Read more..</a>
          </div>
        
      
    </div>

    

    

  </article>

    
      
  <article class="post">
    <header class="post-header">
      <h1 class="post-title">
        
          <a class="post-link" href="/2017/12/03/gtid-rep/">GTID - MySQL Replication</a>
        
      </h1>

      <div class="post-meta">
        <span class="post-time">
          2017-12-03
        </span>
        
          <div class="post-category">
            
              <a href="/categories/MySQL/">MySQL</a>
            
          </div>
        
        
      </div>
    </header>

    
    

    <div class="post-content">
      
        
        
          
        

        
          <p>Binlog replication is <a href="https://acquaai.github.io/2017/12/02/binlog-rep/">here</a>.</p>
<h2 id="mysql-gtid"><a class="markdownIt-Anchor" href="#mysql-gtid"></a> MySQL GTID</h2>
<p>MySQL <code>5.6.6</code>开始支持GTID的新特性，但是需要离线配置，从<code>5.7.6</code>开始支持在线。</p>
<h3 id="enable-gtid-conditions"><a class="markdownIt-Anchor" href="#enable-gtid-conditions"></a> Enable GTID conditions</h3>
<ul>
<li>
<p>MySQL 5.6</p>
</li>
<li>
<p>gtid_mode = ON (required)</p>
</li>
<li>
<p>enforce_gtid_consistency = ON (required)</p>
</li>
<li>
<p>log_bin = ON (required)</p>
</li>
<li>
<p>log_slave_updates = ON (required)</p>
</li>
<li>
<p>MySQL 5.7.13 or higher</p>
</li>
<li>
<p>gtid_mode = ON (required)</p>
</li>
<li>
<p>enforce_gtid_consistency = ON (required)</p>
</li>
<li>
<p>log_bin = ON (option – 高可用切换)</p>
</li>
<li>
<p>log_slave_updates = ON (option – 高可用切换)</p>
</li>
</ul>
          <div class="read-more">
            <a href="/2017/12/03/gtid-rep/" class="read-more-link">Read more..</a>
          </div>
        
      
    </div>

    

    

  </article>

    
      
  <article class="post">
    <header class="post-header">
      <h1 class="post-title">
        
          <a class="post-link" href="/2017/12/03/xfs-resizing/">XFS filesystem resizing</a>
        
      </h1>

      <div class="post-meta">
        <span class="post-time">
          2017-12-03
        </span>
        
          <div class="post-category">
            
              <a href="/categories/DevOps/">DevOps</a>
            
          </div>
        
        
      </div>
    </header>

    
    

    <div class="post-content">
      
        
        
          
        

        
          <h2 id="shrink"><a class="markdownIt-Anchor" href="#shrink"></a> Shrink</h2>
<p><a href="http://xfs.org/" target="_blank" rel="noopener">XFS</a>由硅谷图形开发，支持在线碎片整理和扩容，截至到2017年8月，暂不支持在线收缩，只能dump, mkfs and restore。</p>
<ul>
<li>
<p>Backup home<br>
<code>$ yum install xfsdump</code><br>
<code>$ xfsdump -f /tmp/home.dump /home</code></p>
</li>
<li>
<p>umount home<br>
<code>$ umount /home</code></p>
</li>
<li>
<p>Resize<br>
<code>lvreduce -L 40G /dev/cl/home</code></p>
</li>
<li>
<p>Recreate xfs filesystem<br>
<code>$ mkfs.xfs -f /dev/cl/home</code></p>
</li>
<li>
<p>mount home<br>
<code>$ mount /dev/mapper/cl-home /home</code></p>
</li>
<li>
<p>Restore home<br>
<code>$ xfsrestore -f /tmp/home.dump /home</code></p>
</li>
</ul>
          <div class="read-more">
            <a href="/2017/12/03/xfs-resizing/" class="read-more-link">Read more..</a>
          </div>
        
      
    </div>

    

    

  </article>

    
  </section>

  
  <nav class="pagination">
    
      <a class="prev" href="/page/8/">
        <i class="iconfont icon-left"></i>
        <span class="prev-text">Prev</span>
      </a>
    
    
      <a class="next" href="/page/10/">
        <span class="next-text">Next</span>
        <i class="iconfont icon-right"></i>
      </a>
    
  </nav>


          </div>
          

        </div>
      </main>

      <footer id="footer" class="footer">

  <div class="social-links">
    
      
        
          <a href="mailto:acqua.young@gmail.com" class="iconfont icon-email" title="email"></a>
        
      
    
      
    
      
    
      
    
      
    
      
    
      
        
          <a href="https://github.com/acquaai" class="iconfont icon-github" title="github"></a>
        
      
    
      
    
      
    
      
    
      
    
      
    
      
    
    
    
      <a href="https://acquaai.github.io/atom.xml" class="iconfont icon-rss" title="rss"></a>
    
  </div>


<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://hexo.io/">Hexo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/ahonn/hexo-theme-even">Even</a>
  </span>

  <span class="copyright-year">
    
    &copy; 
     
      2017 - 
    
    2019

    <span class="heart">
      <i class="iconfont icon-heart"></i>
    </span>
    <span class="author">Acqua</span>
  </span>
</div>

      </footer>

      <div class="back-to-top" id="back-to-top">
        <i class="iconfont icon-up"></i>
      </div>
    </div>

    


    




  
    <script type="text/javascript" src="/lib/jquery/jquery-3.1.1.min.js"></script>
  

  
    <script type="text/javascript" src="/lib/slideout/slideout.js"></script>
  

  


    <script type="text/javascript" src="/js/src/even.js?v=2.6.0"></script>
<script type="text/javascript" src="/js/src/bootstrap.js?v=2.6.0"></script><!-- hexo-inject:begin --><!-- hexo-inject:end -->

  </body>
</html>
